document.addEventListener("DOMContentLoaded",(function(){const form=document.getElementById("contactForm");form.addEventListener("submit",(async function(e){e.preventDefault();const recaptchaResponse=grecaptcha.getResponse();if(!recaptchaResponse){alert("Please complete the reCAPTCHA verification");return}const formData=new FormData(form);const data=Object.fromEntries(formData.entries());try{const response=await fetch("/api/contact",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)});if(response.ok){alert("Thank you for your message! We will contact you soon.");form.reset();grecaptcha.reset()}else{throw new Error("Failed to send message")}}catch(error){console.error("Error:",error);alert("Sorry, there was an error sending your message. Please try again later.")}}));const inputs=form.querySelectorAll("input, select, textarea");inputs.forEach((input=>{input.setAttribute("placeholder"," ");if(input.value){input.classList.add("has-value")}input.addEventListener("input",(function(){if(this.value){this.classList.add("has-value")}else{this.classList.remove("has-value")}}))}))}));function createSlug(title){const specialCases={"Energy & Power Generation":"energy_power_generation","Aquatics & Pools":"aquatics_pools","Buildings & Facilities":"buildings_facilities","Food & Beverage":"food_beverage","Metals & Mining":"metals_mining","Oil and Gas":"oil_and_gas","Refining & Chemicals":"refining_chemicals","Municipal Drinking Water":"municipal_drinking_water","Municipal Wastewater Treatment":"municipal_wastewater_treatment","Utility Infrastructure":"utility_infrastructure","General Industry":"general_industry"};if(specialCases[title]){return specialCases[title]}return title.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"")}function createCard(category){const card=document.createElement("div");card.className="card";card.setAttribute("data-id",category.id);const cardImage=document.createElement("div");cardImage.className="card-image";const img=document.createElement("img");img.src=category.image;img.alt=category.title;img.loading="lazy";img.onerror=function(){if(this.src.endsWith(".webp")){this.src=this.src.replace(".webp",".jpg")}img.onerror=function(){this.src="assets/images/placeholder.jpg";this.onerror=null}};const cardContent=document.createElement("div");cardContent.className="card-content";const title=document.createElement("h2");title.className="card-title";title.textContent=category.title;const description=document.createElement("p");description.className="card-description";description.textContent=category.description;cardImage.appendChild(img);cardContent.appendChild(title);cardContent.appendChild(description);card.appendChild(cardImage);card.appendChild(cardContent);card.addEventListener("click",(()=>{const slug=createSlug(category.title);window.location.href=`engineering/${slug}.html`}));return card}function loadImages(category){const images=[category.image,category.imageLarge,category.imageHero];images.forEach((src=>{if(src){const img=new Image;img.src=src;img.onerror=function(){if(src.endsWith(".webp")){this.src=src.replace(".webp",".jpg")}}}}))}function supportsWebP(){return new Promise((resolve=>{const img=new Image;img.onload=function(){resolve(true)};img.onerror=function(){resolve(false)};img.src="data:image/webp;base64,UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA=="}))}function isInViewport(element){const rect=element.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}function handleScrollAnimation(){const cards=document.querySelectorAll(".card:not(.visible)");cards.forEach((card=>{if(isInViewport(card)){card.classList.add("visible")}}))}function preloadImages(){if(typeof categories!=="undefined"){categories.forEach((category=>{const img=new Image;img.src=category.image}))}}document.addEventListener("DOMContentLoaded",(()=>{const cardGrid=document.querySelector(".card-grid");if(typeof categories!=="undefined"&&Array.isArray(categories)){categories.forEach((category=>{const card=createCard(category);cardGrid.appendChild(card);loadImages(category)}))}else{console.error("Categories data not found or invalid");cardGrid.innerHTML='<p class="error-message">Unable to load categories. Please try again later.</p>'}if(window.location.pathname.includes("/engineering/")){updateRelatedSolutions()}}));function loadCategory(category){const heroImage=document.querySelector(".hero-image");heroImage.style.backgroundImage=`url('${category.imageHero}')`;document.querySelector(".category-title").textContent=category.title;document.querySelector(".category-subtitle").textContent=category.subtitle;document.querySelector(".overview-text").textContent=category.content.overview;updateList(".approach-list",category.content.approach);updateList(".technologies-list",category.content.technologies);updateList(".benefits-list",category.content.benefits)}function getRandomCategories(currentCategoryId,count=5){const availableCategories=categories.filter((cat=>cat.id!==currentCategoryId));const shuffled=availableCategories.sort((()=>.5-Math.random()));return shuffled.slice(0,count)}function updateRelatedSolutions(){const relatedSection=document.querySelector(".other-categories, .related-solutions");if(!relatedSection)return;const currentPath=window.location.pathname;const currentCategory=categories.find((cat=>currentPath.includes(createSlug(cat.title))));if(!currentCategory)return;const relatedCategories=getRandomCategories(currentCategory.id);const heading=relatedSection.querySelector("h3");if(heading){heading.textContent="Related Solutions"}const list=relatedSection.querySelector("ul");if(list){list.innerHTML=relatedCategories.map((cat=>`\n            <li>\n                <a href="../engineering/${createSlug(cat.title)}.html">\n                    <div class="related-item">\n                        <img src="../${cat.image}" alt="${cat.title}" loading="lazy" onerror="this.src='../assets/images/placeholder.jpg'">\n                        <span>${cat.title}</span>\n                    </div>\n                </a>\n            </li>\n        `)).join("")+`\n        <li class="view-all">\n            <a href="../engineering.html">\n                <span>View All Categories</span>\n                <i class="fas fa-arrow-right"></i>\n            </a>\n        </li>`}}document.addEventListener("DOMContentLoaded",(function(){const images=document.querySelectorAll("[data-src]");const imageOptions={root:null,rootMargin:"50px 0px",threshold:.1};function loadImage(image){const src=image.getAttribute("data-src");if(!src)return;image.src=src;image.removeAttribute("data-src");if(document.documentElement.classList.contains("webp")){const webpSrc=src.replace(/\.(jpg|jpeg|png)$/,".webp");const img=new Image;img.onload=function(){image.src=webpSrc};img.src=webpSrc}}const imageObserver=new IntersectionObserver(((entries,observer)=>{entries.forEach((entry=>{if(entry.isIntersecting){loadImage(entry.target);observer.unobserve(entry.target)}}))}),imageOptions);images.forEach((img=>imageObserver.observe(img)))}));function setupResponsiveImages(){const pictures=document.querySelectorAll("picture");pictures.forEach((picture=>{const img=picture.querySelector("img");const sources=picture.querySelectorAll("source");sources.forEach((source=>{if(!source.srcset){const src=source.getAttribute("data-srcset");if(src){source.srcset=src;source.removeAttribute("data-srcset")}}}));if(img&&!img.src&&img.getAttribute("data-src")){img.src=img.getAttribute("data-src");img.removeAttribute("data-src")}}))}document.addEventListener("DOMContentLoaded",setupResponsiveImages);document.addEventListener("DOMContentLoaded",(function(){const currentYearElement=document.getElementById("current-year");if(currentYearElement){currentYearElement.textContent=(new Date).getFullYear()}document.querySelectorAll('a[href^="#"]').forEach((anchor=>{anchor.addEventListener("click",(function(e){e.preventDefault();const targetElement=document.querySelector(this.getAttribute("href"));if(targetElement){targetElement.scrollIntoView({behavior:"smooth"})}}))}));const mobileMenuToggle=document.querySelector(".mobile-menu-toggle");const mainMenu=document.querySelector(".main-menu");const menuOverlay=document.querySelector(".menu-overlay");const body=document.body;function closeMenu(){if(mainMenu&&mainMenu.classList.contains("active")){mainMenu.classList.remove("active");if(menuOverlay)menuOverlay.classList.remove("active");if(mobileMenuToggle){mobileMenuToggle.classList.remove("active");mobileMenuToggle.setAttribute("aria-expanded","false")}body.classList.remove("menu-open")}}if(mobileMenuToggle&&mainMenu){mobileMenuToggle.addEventListener("click",(function(e){e.preventDefault();e.stopPropagation();mainMenu.classList.toggle("active");if(menuOverlay)menuOverlay.classList.toggle("active");this.classList.toggle("active");const isExpanded=mainMenu.classList.contains("active");this.setAttribute("aria-expanded",isExpanded);body.classList.toggle("menu-open",isExpanded)}));window.addEventListener("resize",closeMenu);if(menuOverlay){menuOverlay.addEventListener("click",closeMenu)}if(mainMenu){mainMenu.querySelectorAll("a").forEach((link=>{link.addEventListener("click",closeMenu)}))}document.addEventListener("click",(function(e){if(mainMenu.classList.contains("active")){if(!mainMenu.contains(e.target)&&!mobileMenuToggle.contains(e.target)){closeMenu()}}}))}function checkMenuOverflow(){if(window.innerWidth<992){const header=document.querySelector(".header");if(header)header.classList.add("menu-overflow");return}const container=document.querySelector(".header .container");const logo=document.querySelector(".logo");const menu=document.querySelector(".main-menu");const menuItems=document.querySelectorAll(".main-menu li");const header=document.querySelector(".header");if(!container||!menu||!menuItems.length||!logo||!header)return;const availableWidth=container.offsetWidth-logo.offsetWidth-70;let totalMenuWidth=0;menuItems.forEach((item=>{totalMenuWidth+=item.offsetWidth}));if(totalMenuWidth>availableWidth){header.classList.add("menu-overflow")}else{header.classList.remove("menu-overflow")}}checkMenuOverflow();window.addEventListener("load",checkMenuOverflow);const cards=document.querySelectorAll(".card");const cardImages=document.querySelectorAll(".card-image img");function isElementInViewport(el){const rect=el.getBoundingClientRect();const windowHeight=window.innerHeight||document.documentElement.clientHeight;return rect.top<=windowHeight&&rect.bottom>=0}function animateCards(){cards.forEach((card=>{if(isElementInViewport(card)){card.style.opacity="1";card.style.transform="translateY(0)"}}))}cards.forEach((card=>{card.style.opacity="0";card.style.transform="translateY(20px)";card.style.transition="opacity 0.5s ease, transform 0.5s ease"}));window.addEventListener("load",(()=>{setTimeout(animateCards,100)}));window.addEventListener("scroll",(()=>{requestAnimationFrame(animateCards)}))}));